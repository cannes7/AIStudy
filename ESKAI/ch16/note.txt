16장 CNN을 이용한 딥러닝

- CNN의 정의:
신경망은 weight과 bias가 주어진 뉴런으로 구성됨
신경망의 학습 효율은 이 둘을 조율하는 방식으로 높일 수 있음
각각의 뉴런은 일련의 입력을 받아 처리 후 하나의 값을 출력함

deep neural network(심층 신경망)은 신경망을 여러 계층으로 구성한 것
딥러닝(심층 학습) 분야에서 주로 다룸

기존 신경망의 단점은 입력 데이터의 구조를 고려하지 않는다는 것
신경망에 전달하는 모든 데이터를 일차원 배열로 변환하기에
일반 데이터는 괜찮지만 공간적 구조를 가지는 데이터(이미지 등)를 처리하기에는 부적합
흑백 이미지의 예: 2차원 구조, 픽셀의 공간적 배열에 다양한 정보가 숨겨져 있을 때
이러한 정보 무시하면 내부에 존재하는 수많은 패턴 날려버리게 됨

이러한 단점 극복 위해 CNN(Convolutional neural network, 합성곱 신경망) 등장
이미지 처리 시 2D 구조 함께 고려하는 신경망
가중치와 바이어스로 이뤄진 뉴런으로 구성함
CNN의 목적은 입력 계층에 들어온 미가공(raw) 이미지 데이터에 해당하는 클래스 예측
예측된 클래스는 출력 계층의 결과 값 형태로 출력됨

기존 신경망과의 가장 큰 차이는 은닉 계층의 종류와 입력 데이터를 다루는 방식임
CNN은 모든 입력이 이미지처럼 공간 구조 가진다고 가정하며 데이터에서 여러 속성 추출

- CNN의 구조:
기존 신경망 다룰 때는 입력 데이터를 하나의 벡터로 변환하고,
신경망의 입력으로 이 벡터를 전달하고,
다시 신경망을 구성하는 여러 계층을 거침
같은 계층에 속한 뉴런끼리는 서로 연결되지 않음
뉴런은 항상 인접한 서로 다른 계층끼리만 연결됨
신경망의 마지막 계층은 출력 계층으로, 최종 결과를 표현함

이미지를 기존 신경망의 구조로 표현하면 직접 다루기 힘든 형태가 됨
예를 들어 256*256 크기의 RGB 이미지로 구성된 데이터셋:
이미지에서 사용하는 채널 수 = 3이므로
가중치 수 = 256*256*3 = 196K
단 하나의 뉴런에 대한 값이 이 정도이고, 각 계층에 여러 개의 뉴런이 존재하므로
총 가중치의 수는 계층이 추가될 때마다 급격히 증가
즉 엄청나게 많은 수의 매개변수로 구성된 모델을 학습시켜야 한다는 의미
이러한 신경망을 완전 연결 신경망이라고 부르는데, 이를 제대로 처리하기란 현실적으로 불가능
* full connectivity(완전 연결) 신경망: 계층에 있는 모든 뉴런이 이전 계층에 존재하는 모든 뉴런과 연결된 신경망

CNN을 구성하는 뉴런은 3차원(폭, 높이, 깊이)으로 정렬되어 있음
현재 계층에 속한 각각의 뉴런들은 이전 계층의 출력의 일부분에만 연결됨
마치 입력 이미지 위에 N*N 필터를 올려둔 것과 같음
하나의 필터만으로 이미지에 담긴 모든 의미를 찾을 수 없어서
모든 세부 사항을 수집하기 위해 이 작업을 M번 수행함
이때 사용하는 M개의 필터는 feature extractor(특징 추출기) 역할을 함
가장자리나 모서리와 같은 특징을 추출함
CNN의 초반 계층은 이렇게 구성되고, 은닉 계층으로 들어갈수록 좀 더 고차원적인 특징 추출

- CNN에서 사용하는 계층의 종류:
1. 입력 계층:
    미가공 이미지를 그대로 받음
2. convolution 계층:
    입력 계층의 여러 패치와 뉴런 사이의 컨볼루션 연산을 수행
    기본적으로 이전 계층의 출력에 있는 작은 패치와 가중치에 대한 dot product(내적 스칼라곱)을 계산함
3. ReLU(Rectified Linear Unit, 정류 선형 유닛) 계층:
    이전 계층의 출력에 activation(활성) 함수 적용
    활성 함수는 max(0, x)와 같은 형태의 비선형 함수임
    신경망을 이용해 다양한 함수를 근사하려면 신경망에 non-linearity(비선형성)를 추가해야 함
    (각 계층 사이에서 선형으로 분류할 수 없는 데이터까지 성공적으로 분류하기 위함)
4. pooling 계층:
    이전 계층의 출력 일부분만 선택하거나 평균을 내는 방식 등으로 데이터 차원을 줄임
    신경망의 계층을 통과할 때 두드러진 부분만 골라서 처리하게 만들 수 있음
    주어진 K*K 윈도우에서 최댓값을 골라내는 max pooling 기법을 주로 사용
5. full connected(완전 연결) 계층:
    마지막 계층의 출력 결과를 계산
    결과의 크기는 1*1*L이다 (?)
    L은 학습 데이터셋의 클래스 수

픽셀 값으로 표현된 이미지는 계층들을 거치고 나오며 클래스 점수로 변환됨

모델의 정확성과 견고함은 계층의 종류, 신경망의 깊이, 신경망 내부에 배치된 계층의 순서, 계층에서 선택한 함수, 학습 데이터 등이 영향을 미침